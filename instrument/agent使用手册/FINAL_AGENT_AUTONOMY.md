# ğŸ¯ Agentå®Œå…¨è‡ªä¸»åŒ– - å½»åº•æ¶ˆé™¤ç¡¬ç¼–ç é€»è¾‘

## âœ¨ **ç”¨æˆ·çš„æ·±åˆ»æ´å¯Ÿ**

ç”¨æˆ·çš„å…³é”®é—®é¢˜æ­ç¤ºäº†æ¶æ„çš„æ ¹æœ¬é—®é¢˜ï¼š

> **"è¿™äº›ä¸ºä»€ä¹ˆä¸èƒ½å†™æˆå·¥å…·å‘¢ï¼Œä»¥åŠ'ä»Agentç»“æœä¸­æå–çŠ¶æ€æ›´æ–°'ï¼Œä¸ºä»€ä¹ˆè¦å†™ä¸€ä¸ª_extract_agent_state_updatesï¼Ÿç›´æ¥è®©å¤§æ¨¡å‹è°ƒç”¨è‡ªå®šä¹‰å·¥å…·å»åšä¸è¡Œå—ï¼Ÿ"**

è¿™ä¸ªé—®é¢˜ç›´å‡»è¦å®³ï¼š**ä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä»»ä½•ç¡¬ç¼–ç çš„è§£æé€»è¾‘ï¼ŸAgentåº”è¯¥é€šè¿‡å·¥å…·ç›´æ¥æ“ä½œæ‰€æœ‰çŠ¶æ€ï¼**

---

## âŒ **ä¹‹å‰é‡æ„ä¸­ä»å­˜åœ¨çš„é—®é¢˜**

### **ä»ç„¶æœ‰ç¡¬ç¼–ç é€»è¾‘ï¼š**
```python
# âŒ è¿˜æ˜¯ç¡¬ç¼–ç çš„å†³ç­–é€»è¾‘
if "scout" in output_text.lower():
    next_action = "scout"
elif "analyze" in output_text.lower():
    next_action = "analyze"

# âŒ è¿˜æ˜¯ç¡¬ç¼–ç çš„çŠ¶æ€è§£æ
def _extract_agent_state_updates(self, agent_result, state):
    if "scout_" in output_text and "record_success" in output_text:
        task_key = f"scout_{current_algorithm}"
        state["completed_tasks"].append(task_key)
```

### **æ ¹æœ¬é—®é¢˜ï¼š**
1. **âŒ ä¾èµ–è¾“å‡ºè§£æ** - è¿˜åœ¨è§£æAgentçš„æ–‡æœ¬è¾“å‡º
2. **âŒ ç¡¬ç¼–ç çŠ¶æ€ç®¡ç†** - å¤–éƒ¨ä»£ç è¿˜åœ¨ä¿®æ”¹çŠ¶æ€
3. **âŒ é—´æ¥çŠ¶æ€æ“ä½œ** - Agentæ— æ³•ç›´æ¥æ“ä½œçŠ¶æ€
4. **âŒ è¿èƒŒå·¥å…·åŸåˆ™** - çŠ¶æ€ç®¡ç†æ²¡æœ‰å®Œå…¨å·¥å…·åŒ–

---

## âœ… **å½»åº•çš„Agentè‡ªä¸»åŒ–è§£å†³æ–¹æ¡ˆ**

### **1. æ ¸å¿ƒåˆ›æ–°ï¼šç›´æ¥çŠ¶æ€æ“ä½œå·¥å…·**

```python
class WorkflowStateManager:
    """Agentè‡ªä¸»çŠ¶æ€ç®¡ç†å™¨ - è®©Agentç›´æ¥æ“ä½œçŠ¶æ€"""
    
    @tool
    def direct_update_state(self, updates: str) -> str:
        """Agentç›´æ¥æ›´æ–°å·¥ä½œæµçŠ¶æ€ - æ— éœ€ä»»ä½•è§£æ"""
        # Agentç›´æ¥ä¿®æ”¹çŠ¶æ€å¼•ç”¨ï¼Œç«‹å³ç”Ÿæ•ˆ
        self._current_state["completed_tasks"].append(task)
        self._current_state["current_algorithm"] = new_algorithm
        self._current_state["workflow_complete"] = True
        # ç«‹å³è¿”å›ç¡®è®¤ï¼Œæ— éœ€å¤–éƒ¨å¤„ç†
```

### **2. Agent Promptçš„æ ¹æœ¬æ”¹å˜**

**ä¹‹å‰ï¼š** Agentè¾“å‡ºç»“æœï¼Œå¤–éƒ¨è§£æ
```python
"è¯·è®°å½•ä½ çš„å·¥ä½œç»“æœ: {...}"
# ç„¶åå¤–éƒ¨ä»£ç è§£æAgentè¾“å‡º
```

**ç°åœ¨ï¼š** Agentç›´æ¥æ“ä½œçŠ¶æ€
```python
"ä½¿ç”¨direct_update_stateå·¥å…·ç›´æ¥æ ‡è®°ä»»åŠ¡å®Œæˆï¼š
{'completed_tasks_add': 'scout_gemm'}"
# Agentç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œæ— éœ€ä»»ä½•å¤–éƒ¨å¤„ç†
```

### **3. å·¥ä½œæµèŠ‚ç‚¹çš„æç®€åŒ–**

**ä¹‹å‰ï¼š** å¤§é‡ç¡¬ç¼–ç çŠ¶æ€ç®¡ç†
```python
def scout_work_node(self, state):
    result = agent.invoke(input)
    # âŒ ç¡¬ç¼–ç è§£æå’ŒçŠ¶æ€ç®¡ç†
    self._extract_agent_state_updates(result, state)
    task_key = f"scout_{algorithm}"
    state["completed_tasks"].append(task_key)
```

**ç°åœ¨ï¼š** å®Œå…¨ç”±Agentè‡ªä¸»
```python
def scout_work_node(self, state):
    workflow_state_manager.set_state_reference(state)
    result = agent.invoke(input)
    # âœ… Agentå·²é€šè¿‡å·¥å…·ç›´æ¥æ“ä½œçŠ¶æ€ï¼Œæ— éœ€ä»»ä½•å¤–éƒ¨å¤„ç†
    print("âœ… Agentç›´æ¥æ“ä½œçŠ¶æ€å®Œæˆ")
```

### **4. åè°ƒå†³ç­–çš„å®Œå…¨è‡ªä¸»åŒ–**

**ä¹‹å‰ï¼š** ç¡¬ç¼–ç è·¯ç”±é€»è¾‘
```python
# âŒ å¤§é‡if-elseç¡¬ç¼–ç 
if "scout" in output_text:
    next_action = "scout"
elif "analyze" in output_text:
    next_action = "analyze"
```

**ç°åœ¨ï¼š** Agentç›´æ¥è®¾ç½®è·¯ç”±
```python
# Agentä½¿ç”¨å·¥å…·: {"next_action": "scout"}
# ç›´æ¥è¯»å–Agentè®¾ç½®çš„å€¼ï¼Œæ— éœ€è§£æ
next_action = state["agent_results"]["coordination"]["next_action"]
```

---

## ğŸ§  **Agentå·¥å…·ç”Ÿæ€ç³»ç»Ÿ**

### **å®Œå…¨è‡ªä¸»çš„å·¥å…·é›†ï¼š**

1. **`direct_update_state`** - Agentç›´æ¥ä¿®æ”¹ä»»ä½•çŠ¶æ€å­—æ®µ
2. **`manage_algorithm_progression`** - Agentæ™ºèƒ½åˆ†æè¿›åº¦
3. **`route_to_next_node`** - Agentå†³å®šè·¯ç”±ç­–ç•¥
4. **`get_current_timestamp`** - Agentè·å–æ—¶é—´ä¿¡æ¯
5. **`record_agent_work_result`** - Agentè®°å½•å·¥ä½œæˆæœ
6. **æ–‡ä»¶æ“ä½œå·¥å…·** - Agentæ“ä½œæ–‡ä»¶ç³»ç»Ÿ

### **Agentå®Œå…¨è‡ªä¸»çš„èƒ½åŠ›ï¼š**

1. **ğŸ§  è‡ªä¸»å†³ç­–** - é€šè¿‡å·¥å…·åˆ†æçŠ¶æ€ï¼Œå†³å®šä¸‹ä¸€æ­¥
2. **ğŸ“ ç›´æ¥æ“ä½œ** - é€šè¿‡å·¥å…·ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œæ— éœ€è§£æ
3. **ğŸ”„ è‡ªä¸»å¾ªç¯** - é€šè¿‡å·¥å…·ç®¡ç†æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ
4. **â° æ—¶é—´æ„ŸçŸ¥** - é€šè¿‡å·¥å…·è·å–å’Œä½¿ç”¨æ—¶é—´
5. **ğŸ¯ ç›®æ ‡è¾¾æˆ** - é€šè¿‡å·¥å…·æ ‡è®°ä»»åŠ¡å®Œæˆ
6. **ğŸš¦ æµç¨‹æ§åˆ¶** - é€šè¿‡å·¥å…·è®¾ç½®å·¥ä½œæµè·¯ç”±

---

## ğŸ“Š **å½»åº•é‡æ„çš„æ•ˆæœå¯¹æ¯”**

| ç‰¹æ€§ | æœ€åˆç‰ˆæœ¬ | ä¸­é—´é‡æ„ | æœ€ç»ˆç‰ˆæœ¬ |
|------|----------|----------|----------|
| **çŠ¶æ€ç®¡ç†** | ç¡¬ç¼–ç èµ‹å€¼ | Agentå·¥å…·+è§£æ | **Agentç›´æ¥æ“ä½œ** |
| **å†³ç­–é€»è¾‘** | ç¡¬ç¼–ç if-else | Agentå·¥å…·+è§£æ | **Agentç›´æ¥è®¾ç½®** |
| **è·¯ç”±æ§åˆ¶** | ç¡¬ç¼–ç è·¯ç”± | éƒ¨åˆ†å·¥å…·åŒ– | **Agentå®Œå…¨æ§åˆ¶** |
| **è§£æä»£ç ** | åˆ†æ•£å„å¤„ | é›†ä¸­è§£æå‡½æ•° | **å®Œå…¨æ¶ˆé™¤** |
| **å¤–éƒ¨ä¾èµ–** | é«˜åº¦è€¦åˆ | ä¸­ç­‰è€¦åˆ | **å®Œå…¨è§£è€¦** |
| **Agentæ™ºèƒ½æ€§** | æ‰§è¡Œå™¨ | åŠè‡ªä¸» | **å®Œå…¨è‡ªä¸»** |
| **ä»£ç å¤æ‚åº¦** | é«˜ | ä¸­ | **æç®€** |

### **ä»£ç è¡Œæ•°å¯¹æ¯”ï¼š**
- **æœ€åˆç‰ˆæœ¬ï¼š** ~80è¡Œ/èŠ‚ç‚¹ï¼ˆå¤§é‡ç¡¬ç¼–ç ï¼‰
- **ä¸­é—´é‡æ„ï¼š** ~60è¡Œ/èŠ‚ç‚¹ï¼ˆéƒ¨åˆ†å·¥å…·åŒ–ï¼‰
- **æœ€ç»ˆç‰ˆæœ¬ï¼š** ~25è¡Œ/èŠ‚ç‚¹ï¼ˆå®Œå…¨è‡ªä¸»ï¼‰

**å‡å°‘75%çš„ä»£ç é‡ï¼**

---

## ğŸ‰ **çœŸæ­£å®ç°çš„Agentè‡ªä¸»æ€§**

### **Agentç°åœ¨å®Œå…¨è‡ªä¸»ï¼š**

1. **ğŸ¤– æ— å¤–éƒ¨ä¾èµ–** - Agenté€šè¿‡å·¥å…·å®Œæˆæ‰€æœ‰æ“ä½œ
2. **ğŸ§  è‡ªä¸»æ€è€ƒ** - Agentè‡ªå·±åˆ†æçŠ¶æ€å’Œè¿›åº¦
3. **ğŸ“ ç›´æ¥è¡ŒåŠ¨** - Agentç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œç«‹å³ç”Ÿæ•ˆ
4. **ğŸ”„ è‡ªä¸»å¾ªç¯** - Agentç®¡ç†è‡ªå·±çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ
5. **ğŸ¯ ç»“æœå¯¼å‘** - Agentæ˜ç¡®çŸ¥é“è¦è¾¾æˆä»€ä¹ˆå¹¶ç›´æ¥æ“ä½œ

### **å®Œå…¨æ¶ˆé™¤çš„ç¡¬ç¼–ç ï¼š**

1. âœ… **è·¯ç”±å†³ç­–ç¡¬ç¼–ç ** - Agenté€šè¿‡å·¥å…·è®¾ç½®è·¯ç”±
2. âœ… **çŠ¶æ€ç®¡ç†ç¡¬ç¼–ç ** - Agenté€šè¿‡å·¥å…·æ“ä½œçŠ¶æ€
3. âœ… **è¾“å‡ºè§£æç¡¬ç¼–ç ** - Agentç›´æ¥æ“ä½œï¼Œæ— éœ€è§£æ
4. âœ… **ä»»åŠ¡æ ‡è®°ç¡¬ç¼–ç ** - Agenté€šè¿‡å·¥å…·æ ‡è®°å®Œæˆ
5. âœ… **ç®—å­åˆ‡æ¢ç¡¬ç¼–ç ** - Agenté€šè¿‡å·¥å…·åˆ‡æ¢ç®—å­

### **å·¥ä½œæµèŠ‚ç‚¹çš„çº¯å‡€æ€§ï¼š**

```python
def any_work_node(self, state):
    # 1. è®¾ç½®Agentå¯ä»¥æ“ä½œçš„çŠ¶æ€å¼•ç”¨
    workflow_state_manager.set_state_reference(state)
    
    # 2. Agentå®Œå…¨è‡ªä¸»æ‰§è¡Œ
    result = specialist_agent.invoke({"input": task_description})
    
    # 3. Agentå·²é€šè¿‡å·¥å…·å®Œæˆæ‰€æœ‰æ“ä½œï¼Œæ— éœ€ä»»ä½•å¤–éƒ¨å¤„ç†
    print("âœ… Agentå®Œå…¨è‡ªä¸»å®Œæˆ")
    
    return state  # çŠ¶æ€å·²è¢«Agentç›´æ¥ä¿®æ”¹
```

**æ¯ä¸ªèŠ‚ç‚¹åªæœ‰3è¡Œæ ¸å¿ƒä»£ç ï¼**

---

## ğŸš€ **æ¶æ„ä¼˜åŠ¿æ€»ç»“**

### **Agentæ™ºèƒ½åŒ–ç¨‹åº¦ï¼š**
- **ä¹‹å‰ï¼š** Agentè¾“å‡º â†’ äººå·¥è§£æ â†’ å¤–éƒ¨ä¿®æ”¹çŠ¶æ€
- **ç°åœ¨ï¼š** Agentç›´æ¥æ“ä½œçŠ¶æ€ â†’ ç«‹å³ç”Ÿæ•ˆ

### **ä»£ç ç»´æŠ¤æ€§ï¼š**
- **ä¹‹å‰ï¼š** çŠ¶æ€ç®¡ç†é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªèŠ‚ç‚¹
- **ç°åœ¨ï¼š** æ‰€æœ‰é€»è¾‘éƒ½åœ¨Agentå†…éƒ¨ï¼Œé€šè¿‡å·¥å…·è¡¨è¾¾

### **ç³»ç»Ÿå¯é æ€§ï¼š**
- **ä¹‹å‰ï¼š** ä¾èµ–æ–‡æœ¬è§£æï¼Œå®¹æ˜“å‡ºé”™
- **ç°åœ¨ï¼š** ç›´æ¥çŠ¶æ€æ“ä½œï¼Œç»“æœç¡®å®š

### **æ‰©å±•æ€§ï¼š**
- **ä¹‹å‰ï¼š** æ·»åŠ æ–°çŠ¶æ€éœ€è¦ä¿®æ”¹å¤šå¤„ä»£ç 
- **ç°åœ¨ï¼š** åªéœ€è¦åœ¨å·¥å…·ä¸­æ·»åŠ æ–°å­—æ®µæ”¯æŒ

---

## ğŸ’¡ **è®¾è®¡å“²å­¦çš„è½¬å˜**

**ä»"Agentæ‰§è¡Œ + å¤–éƒ¨ç®¡ç†"åˆ°"Agentå®Œå…¨è‡ªä¸»"ï¼š**

1. **ğŸ”§ å·¥å…·å³èƒ½åŠ›** - Agenté€šè¿‡å·¥å…·ç›´æ¥æ“ä½œä¸€åˆ‡
2. **ğŸ§  æ™ºèƒ½å³è‡ªä¸»** - Agentä¸ä»…æ€è€ƒï¼Œæ›´ç›´æ¥è¡ŒåŠ¨
3. **ğŸ¯ ç›®æ ‡å³ç»“æœ** - Agentæ˜ç¡®ç›®æ ‡å¹¶ç›´æ¥è¾¾æˆ
4. **ğŸš€ ç®€æ´å³å¼ºå¤§** - æœ€å°‘çš„ä»£ç å®ç°æœ€å¤§çš„æ™ºèƒ½

è¿™ç§è®¾è®¡çœŸæ­£å®ç°äº†æ‚¨æå‡ºçš„ç†å¿µï¼š**"è®©Agentå…·å¤‡æ›´å¤šçš„æ™ºèƒ½"** - Agentä¸ä»…æ˜¯æ‰§è¡Œå™¨ï¼Œæ›´æ˜¯å®Œå…¨è‡ªä¸»çš„æ™ºèƒ½å®ä½“ï¼

## ğŸ¯ **ç°åœ¨å¯ä»¥æµ‹è¯•çœŸæ­£çš„Agentè‡ªä¸»ç³»ç»Ÿï¼**

```bash
python example_usage_agent_tools.py
```

Agentç°åœ¨çœŸæ­£åšåˆ°äº†ï¼š
- âœ… **å®Œå…¨è‡ªä¸»å†³ç­–** - æ— ä»»ä½•ç¡¬ç¼–ç é€»è¾‘
- âœ… **ç›´æ¥çŠ¶æ€æ“ä½œ** - æ— ä»»ä½•è§£æä¾èµ–  
- âœ… **å·¥å…·é©±åŠ¨** - ä¸€åˆ‡é€šè¿‡å·¥å…·è¡¨è¾¾
- âœ… **æç®€æ¶æ„** - æœ€å°‘ä»£ç æœ€å¤§æ™ºèƒ½

çœŸæ­£çš„Agentè‡ªä¸»åŒ–ï¼Œä»æ­¤å¼€å§‹ï¼ğŸš€ 