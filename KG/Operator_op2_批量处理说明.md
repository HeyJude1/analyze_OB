# Operator_op2.py æ‰¹é‡å¤„ç†åŠŸèƒ½è¯´æ˜

## ğŸ“‹ æ–°å¢åŠŸèƒ½

ä¸º `Operator_op2.py` æ·»åŠ äº†æ‰¹é‡å¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å¤„ç† `openblas_output/` ç›®å½•ä¸­çš„æ‰€æœ‰ç®—å­æ–‡ä»¶ï¼Œå¤§å¤§æé«˜äº†å¤„ç†æ•ˆç‡ã€‚

## ğŸ”§ æ–°å¢å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|--------|------|
| `--batch` | flag | False | å¯ç”¨æ‰¹é‡å¤„ç†æ¨¡å¼ |
| `--openblas_dir` | str | `../Morph/openblas_output` | OpenBLASè¾“å‡ºç›®å½•è·¯å¾„ |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æ‰¹é‡å¤„ç†ï¼ˆæ¨èï¼‰

```bash
cd /home/dgc/mjs/project/analyze_OB/KG

# ä½¿ç”¨é»˜è®¤OpenBLASç›®å½•
python Operator_op2.py --batch

# æŒ‡å®šOpenBLASç›®å½•
python Operator_op2.py --batch --openblas_dir /path/to/openblas_output

# æŒ‡å®šè¾“å‡ºç›®å½•
python Operator_op2.py --batch --output_dir /custom/output/path
```

### 2. å•æ–‡ä»¶å¤„ç†ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰

```bash
# å¤„ç†å•ä¸ªæ–‡ä»¶
python Operator_op2.py --source /path/to/01_gemm.c

# æŒ‡å®šè¾“å‡ºç›®å½•
python Operator_op2.py --source /path/to/01_gemm.c --output_dir /custom/output/path
```

## ğŸ“Š æ‰¹é‡å¤„ç†æµç¨‹

### 1. æ–‡ä»¶å‘ç°
```
ğŸ“‹ æ‰¾åˆ° 10 ä¸ªç®—å­æ–‡ä»¶:
   - 01_gemm.c
   - 02_gemv.c
   - 03_axpby.c
   - 04_dot.c
   - 05_swap.c
   - 06_copy.c
   - 07_nrm2.c
   - 08_asum.c
   - 09_iamax.c
   - 10_iamin.c
```

### 2. é€ä¸ªå¤„ç†
```
ğŸš€ å¼€å§‹æ‰¹é‡å¤„ç†...

[1/10] ==================================================
ğŸ”„ å¤„ç†ç®—å­: 01_gemm
ğŸ“ è¾“å‡ºç›®å½•: /home/dgc/mjs/project/analyze_OB/op_results/01_gemm
ğŸ“„ è¾“å‡ºæ–‡ä»¶: /home/dgc/mjs/project/analyze_OB/op_results/01_gemm/01_gemm.json
âœ… å®Œæˆ: 01_gemm

[2/10] ==================================================
ğŸ”„ å¤„ç†ç®—å­: 02_gemv
ğŸ“ è¾“å‡ºç›®å½•: /home/dgc/mjs/project/analyze_OB/op_results/02_gemv
ğŸ“„ è¾“å‡ºæ–‡ä»¶: /home/dgc/mjs/project/analyze_OB/op_results/02_gemv/02_gemv.json
âœ… å®Œæˆ: 02_gemv

...
```

### 3. ç»“æœç»Ÿè®¡
```
ğŸ‰ æ‰¹é‡å¤„ç†å®Œæˆ!
ğŸ“Š å¤„ç†ç»“æœ: 10/10 æˆåŠŸ
ğŸ“ ç»“æœä¿å­˜åœ¨: /home/dgc/mjs/project/analyze_OB/op_results
```

## ğŸ“ è¾“å‡ºç»“æ„

æ‰¹é‡å¤„ç†åçš„è¾“å‡ºç›®å½•ç»“æ„ï¼š

```
/home/dgc/mjs/project/analyze_OB/op_results/
â”œâ”€â”€ 01_gemm/
â”‚   â””â”€â”€ 01_gemm.json
â”œâ”€â”€ 02_gemv/
â”‚   â””â”€â”€ 02_gemv.json
â”œâ”€â”€ 03_axpby/
â”‚   â””â”€â”€ 03_axpby.json
â”œâ”€â”€ 04_dot/
â”‚   â””â”€â”€ 04_dot.json
â”œâ”€â”€ 05_swap/
â”‚   â””â”€â”€ 05_swap.json
â”œâ”€â”€ 06_copy/
â”‚   â””â”€â”€ 06_copy.json
â”œâ”€â”€ 07_nrm2/
â”‚   â””â”€â”€ 07_nrm2.json
â”œâ”€â”€ 08_asum/
â”‚   â””â”€â”€ 08_asum.json
â”œâ”€â”€ 09_iamax/
â”‚   â””â”€â”€ 09_iamax.json
â””â”€â”€ 10_iamin/
    â””â”€â”€ 10_iamin.json
```

æ¯ä¸ªJSONæ–‡ä»¶åŒ…å«ï¼š
- `final_strategies`: æ¨èçš„ä¼˜åŒ–ç­–ç•¥
- `search_strategies`: æœç´¢åˆ°çš„æ‰€æœ‰ç­–ç•¥
- `patterns_detected`: æ£€æµ‹åˆ°çš„è®¡ç®—æ¨¡å¼
- `top_patterns_per_type`: æŒ‰ç±»å‹åˆ†ç»„çš„é¡¶çº§æ¨¡å¼

## ğŸ”„ ä¸ç°æœ‰æµç¨‹é›†æˆ

### æ›´æ–°åçš„å®Œæ•´æµç¨‹

```bash
# 1. æ‰¹é‡ç”Ÿæˆä¼˜åŒ–ç­–ç•¥
cd /home/dgc/mjs/project/analyze_OB/KG
python Operator_op2.py --batch

# 2. ä½¿ç”¨ç­–ç•¥ç”Ÿæˆä¼˜åŒ–ä»£ç 
cd /home/dgc/mjs/project/analyze_OB/Morph
python functions/llmgenv4.py --input prompts1.json

# 3. æˆ–è€…ä½¿ç”¨ä¸€é”®è„šæœ¬
python run_blas_generation.py
```

### run_blas_generation.py çš„æ›´æ–°

åŸæ¥çš„é€ä¸ªå¤„ç†ï¼š
```python
for operator in operators:
    source_file = openblas_dir / f"{operator}.c"
    cmd = f"python Operator_op2.py --source {source_file}"
    result = run_command(cmd, cwd=kg_dir)
```

ç°åœ¨çš„æ‰¹é‡å¤„ç†ï¼š
```python
cmd = f"python Operator_op2.py --batch --openblas_dir {openblas_dir}"
result = run_command(cmd, cwd=kg_dir)
```

## âš¡ æ€§èƒ½ä¼˜åŠ¿

| æ–¹é¢ | åŸæ¥é€ä¸ªå¤„ç† | ç°åœ¨æ‰¹é‡å¤„ç† | æ”¹è¿› |
|-----|-------------|-------------|------|
| **å‘½ä»¤æ‰§è¡Œæ¬¡æ•°** | 10æ¬¡ | 1æ¬¡ | âœ… å‡å°‘90% |
| **åˆå§‹åŒ–å¼€é”€** | 10æ¬¡ | 1æ¬¡ | âœ… å¤§å¹…å‡å°‘ |
| **Milvusè¿æ¥** | 10æ¬¡ | 1æ¬¡ | âœ… è¿æ¥å¤ç”¨ |
| **é…ç½®åŠ è½½** | 10æ¬¡ | 1æ¬¡ | âœ… é¿å…é‡å¤ |
| **æ€»å¤„ç†æ—¶é—´** | ~5-10åˆ†é’Ÿ | ~1-2åˆ†é’Ÿ | âœ… æå‡3-5å€ |

## ğŸ› ï¸ é”™è¯¯å¤„ç†

### 1. å•ä¸ªæ–‡ä»¶å¤±è´¥ä¸å½±å“æ•´ä½“
```
[3/10] ==================================================
ğŸ”„ å¤„ç†ç®—å­: 03_axpby
âŒ é”™è¯¯: å¤„ç† 03_axpby æ—¶å‡ºé”™: Connection timeout

[4/10] ==================================================
ğŸ”„ å¤„ç†ç®—å­: 04_dot
âœ… å®Œæˆ: 04_dot
```

### 2. ç›®å½•ä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»º
```
ğŸ“ è¾“å‡ºç›®å½•: /home/dgc/mjs/project/analyze_OB/op_results/01_gemm
```

### 3. è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
```
âŒ é”™è¯¯ï¼šæºæ–‡ä»¶ä¸å­˜åœ¨: /path/to/missing_file.c
âŒ é”™è¯¯ï¼šOpenBLASè¾“å‡ºç›®å½•ä¸å­˜åœ¨: /invalid/path
âš ï¸ è­¦å‘Šï¼šåœ¨ /path/to/dir ä¸­æœªæ‰¾åˆ°.cæ–‡ä»¶
```

## ğŸ§ª æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
cd /home/dgc/mjs/project/analyze_OB
python test_batch_operator.py
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸš€ Operator_op2.py æ‰¹é‡å¤„ç†åŠŸèƒ½æµ‹è¯•
================================================================================
ğŸ” æ£€æŸ¥OpenBLASè¾“å‡ºæ–‡ä»¶...
ğŸ“‹ æ‰¾åˆ° 10 ä¸ª.cæ–‡ä»¶:
   - 01_gemm.c
   - 02_gemv.c
   ...

ğŸ§ª æµ‹è¯•å•æ–‡ä»¶å¤„ç†
============================================================
ğŸ”„ æ‰§è¡Œå‘½ä»¤: python Operator_op2.py --source /path/to/01_gemm.c
âœ… å‘½ä»¤æ‰§è¡ŒæˆåŠŸ

ğŸ§ª æµ‹è¯•æ‰¹é‡å¤„ç†
============================================================
ğŸ”„ æ‰§è¡Œå‘½ä»¤: python Operator_op2.py --batch --openblas_dir /path/to/openblas_output
âœ… å‘½ä»¤æ‰§è¡ŒæˆåŠŸ

ğŸ“Š æ£€æŸ¥ç”Ÿæˆç»“æœ
============================================================
ğŸ“ æ‰¾åˆ° 10 ä¸ªç®—å­ç›®å½•:
   âœ… 01_gemm: 15234 å­—èŠ‚
   âœ… 02_gemv: 12456 å­—èŠ‚
   ...

ğŸ“ˆ æˆåŠŸç‡: 10/10 (100.0%)

================================================================================
ğŸ æµ‹è¯•ç»“æœæ€»ç»“:
   - OpenBLASæ–‡ä»¶æ£€æŸ¥: âœ… é€šè¿‡
   - å•æ–‡ä»¶å¤„ç†: âœ… é€šè¿‡
   - æ‰¹é‡å¤„ç†: âœ… é€šè¿‡
   - ç»“æœæ£€æŸ¥: âœ… é€šè¿‡

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ‰¹é‡å¤„ç†åŠŸèƒ½æ­£å¸¸å·¥ä½œ
```

## ğŸ“‹ ä½¿ç”¨å»ºè®®

### 1. æ¨èä½¿ç”¨æ‰¹é‡å¤„ç†
- æ•ˆç‡æ›´é«˜ï¼Œå‡å°‘é‡å¤å¼€é”€
- ç»Ÿä¸€çš„å¤„ç†æµç¨‹å’Œé”™è¯¯å¤„ç†
- æ›´å¥½çš„è¿›åº¦æ˜¾ç¤º

### 2. é€‚åˆå•æ–‡ä»¶å¤„ç†çš„åœºæ™¯
- è°ƒè¯•ç‰¹å®šç®—å­
- æµ‹è¯•æ–°çš„æºæ–‡ä»¶
- éœ€è¦ç‰¹æ®Šé…ç½®çš„æƒ…å†µ

### 3. é…ç½®å»ºè®®
- ç¡®ä¿MilvusæœåŠ¡æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ `kg_config.json` é…ç½®æ­£ç¡®
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜å‚¨ç»“æœ

## ğŸ‰ æ€»ç»“

æ‰¹é‡å¤„ç†åŠŸèƒ½çš„æ·»åŠ æ˜¾è‘—æå‡äº† `Operator_op2.py` çš„ä½¿ç”¨æ•ˆç‡ï¼š

- âœ… **ä¸€é”®å¤„ç†**: ä¸€ä¸ªå‘½ä»¤å¤„ç†æ‰€æœ‰ç®—å­
- âœ… **æ€§èƒ½æå‡**: å¤„ç†æ—¶é—´å‡å°‘3-5å€
- âœ… **é”™è¯¯éš”ç¦»**: å•ä¸ªå¤±è´¥ä¸å½±å“æ•´ä½“
- âœ… **è¿›åº¦å¯è§†**: æ¸…æ™°çš„å¤„ç†è¿›åº¦æ˜¾ç¤º
- âœ… **å‘ä¸‹å…¼å®¹**: ä¿æŒåŸæœ‰å•æ–‡ä»¶å¤„ç†åŠŸèƒ½

è¿™ä¸ºåç»­çš„LLMä»£ç ç”Ÿæˆæµç¨‹æä¾›äº†æ›´é«˜æ•ˆçš„ä¼˜åŒ–ç­–ç•¥å‡†å¤‡ï¼
